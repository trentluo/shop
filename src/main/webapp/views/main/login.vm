<link href="${WEB_RESOURCE.staticAddress}/css/login.css?${WEB_RESOURCE.version}" rel="stylesheet" media="screen"  id="theme_date">
<div class="wrap">
		<div class="exLonin-box">
              <div class="exLogin-main">
                  <P class="exLogin-tit">会员登录</P>
                  <form id="loginForm" class="" action="" method="POST">
			             <input type="hidden" name="callback_url" id="callback_url" value="$!resp.callback"/>
			             <div class="login-line mart10" style="display:none;" id="login_error_msg_parent">
                               <label class="label-no" for="login-user">提示</label>
                               <div class="element pos_rel">
                                     <p class="index_longin_tips warn" id="login_error_msg" style="margin-left:0px;">密码错误</p>
                                     <div class="clear"></div>
                               </div>
                          </div>
		                 <div class="login-line">
		                       <label class="label-no" for="login-user">用户名</label>
		                       <div class="element pos_rel">
		                             <input type="text" class="login-text login-icon-user" name="email" id="userEmail" placeholder="请输入管理员账号" autocomplete="off" maxlength="50"  style="padding-left:0px;width:219px;" />
		                             <div class="clear"></div>
		                       </div>
		                  </div>
		                  <input type="hidden" id="captcha_value" name="captcha_value" />
		                  <input type="hidden" id="operator_loginName" name="operator_loginName" />
		                  <div class="login-line">
		                       <label class="label-no" for="login-password">校验码</label>
		                       <div class="element pos_rel">
		                             <input type="text" class="login-text" name="login_captcha" id="login_captcha" placeholder="校验码" style="padding-left:0px;width:98px;" autocomplete="off" />
		                             <span class="index_yzm marl10">
		                             <img id="randImage" src="#springUrl('/captcha-image.htm')" style="cursor: pointer;" width="102" height="34" onclick="reloadcode();" /></span>
		                             <div class="clear"></div>
		                       </div>
		                  </div>
		                  <div class="login-line">
		                       <input id="normalSubmit" class="btn-settlement" type="submit" value="登 录">
		                  </div>							   
		      		</from>
              </div>
         </div>
    </div>     
    

<script type="text/javascript">
	$(window).load(function(){							 
            $.cookie('kjt_ent_user_name',null,{path: '/enterpriseWallet',domain: '${WEB_RESOURCE.staticAddressDomain}'});
     });

	function reloadcode() {
	   	$("#randImage").attr("src","#springUrl('/captcha-image.htm')?id="+Math.random());
	}
	
	$("#login_captcha").blur(function(){
		$("#captcha_value").val($("#login_captcha").val());
	});
	
	$("#userEmail").blur(function(){
       	var manageUser = $.trim($("#userEmail").val());
       	if(manageUser == null || manageUser == ''){
       		return;
       	}  
       	var regPattern_email = /^(\w)+(\.\w+)*@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,4}$/;
		if(!regPattern_email.test(manageUser)) {
        	$("#login_error_msg").html('登录用户名不正确!');
        	$("#login_error_msg_parent").show();
        	reloadcode();
        	$("#user_login_submit").attr("disabled", "disabled");
			return false;
		}
	});
	
	
	//表单提交
	function userLoginSubmit() {
		/** if(pgeditor.pwdLength()==0){
	    	$("#login_error_msg").html('登录密码不能为空');
	    	$("#login_error_msg_parent").show();
	       	$("#_ocx_password").focus();
	       	reloadcode();
	       	return false;
	     }
	  
	   if(pgeditor.pwdValid()==1){
	   		$("#login_error_msg").html('登录密码不符合要求');
	    	$("#login_error_msg_parent").show();
	       	$("#_ocx_password").focus();
	       	reloadcode();
	       	return false;
	     }  
		 jQuery.ajax({
              url: "#springUrl('/ocx/generateRandomKey.htm')",
              type: "POST",
           	  async: false,
              success: function(result){
                  pgeditor.pwdSetSk(result);
              }
         });  
		 
	     var PwdResult=pgeditor.pwdResult();
	    $("#password").val(PwdResult);//获得密码密文,赋值给表单  */
	    
	    var manageUser = $.trim($("#manageUser").val());
	    
	    if(""==manageUser) {
	    	$("#login_error_msg").html('登录用户名不能为空!');
        	$("#login_error_msg_parent").show();
			return false;
	    }
	    
	    var regPattern_email = /^(\w)+(\.\w+)*@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,4}$/;
		var regPattern_mobile = /^[1]([3][0-9]{1}|([4][7]{1})|([5][0-3|5-9]{1})|([8][0-9]{1}))[0-9]{8}$/;
		if(!regPattern_email.test(manageUser) && !regPattern_mobile.test(manageUser)) {
        	$("#login_error_msg").html('登录用户名不正确!');
        	$("#login_error_msg_parent").show();
			return false;
		}
		
		var operator = $("#operator  option:selected").val();
		$("#operator_loginName").val(operator);
		
		var operator_type_value= $("#operator  option:selected").attr('data-for');
		$("#operatorId").val(operator_type_value);
		
		var login_captcha = $("#login_captcha").val();
		if ("" == login_captcha) {
        	$("#login_error_msg").html('验证码不能为空!');
        	$("#login_error_msg_parent").show();
			return false;
		}
		
		var captcha_value = $("#captcha_value").val();
		if(captcha_value!=login_captcha) {
			$("#login_error_msg").html('验证码填写错误!');
        	$("#login_error_msg_parent").show();
        	return false;
		}
		
	    jQuery.ajax({
			url:"#springUrl('/login/main.htm')",
			type:'post',
			dataType:'json',
			data:$("#loginForm").serialize(),
			success:function(data, textStatus, jqXHR){
				if(data.success) {
					window.location.href = data.redirect;
                } else {
                	$("#login_error_msg").html(data.message);
                	$("#login_error_msg_parent").show();
                	reloadcode();
				}
			},
			error:function(XMLHttpRequest, textStatus, errorThrown){
				return false;
			}
		});
	};
</script>