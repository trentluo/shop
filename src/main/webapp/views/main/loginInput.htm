<link href="${WEB_RESOURCE.staticAddress}enterpriseWallet/css/index.css${WEB_RESOURCE.staticVersion}" type="text/css" rel="stylesheet" media="screen">
<style>
	.ocx_style {
	    border: 1px solid #7F9DB9;
	    height: 32px;
	    width: 222px;
	}
</style>
<script>
 //密码控件js
 if(navigator.userAgent.indexOf("MSIE")<0){
    navigator.plugins.refresh();
 }
 
 var pgeditor = new jQuery.pge({
  pgePath: "${WEB_RESOURCE.staticAddress}enterpriseWallet/ocx/",//控件文件目录  (个人的："${WEB_RESOURCE.staticAddress}wallet/ocx/")
  pgeId: "_ocx_password",//控件ID
  pgeEdittype: 0,//控件类型,0星号,1明文
  pgeEreg1: "[\\s\\S]*",//输入过程中字符类型限制
  pgeEreg2: "[\\s\\S]{6,12}", //输入完毕后字符类型判断条件
  pgeMaxlength: 12,//允许最大输入长度
  pgeTabindex: 2,//tab键顺序
  pgeClass: "ocx_style",//控件css样式
  pgeInstallClass: "ocx_style",//针对安装或升级
  pgeOnkeydown:"FormSubmit()",//回车键响应函数
     tabCallback:"login_captcha"
 });
 
 window.onload = function(){ 
    pgeditor.pgInitialize();//初始化控件
 }  
</script>
<div class="wrap">
		<div class="exLonin-box">
              <div class="exLogin-main">
                  <P class="exLogin-tit">商户会员登录</P>
                  <form id="loginForm" class="" action="" method="POST">
			             <input type="hidden" id="operatorId" name="operatorId" value="" />
			             <input type="hidden" name="password" id="password" value=""/>
			             <input type="hidden" name="redirect_url" id="redirect_url" value="$!response.data.redirect_url"/>
			             <div class="login-line mart10" style="display:none;" id="login_error_msg_parent">
                               <label class="label-no" for="login-user">提示</label>
                               <div class="element pos_rel">
                                     <p class="index_longin_tips warn" id="login_error_msg" style="margin-left:0px;">密码错误</p>
                                     <div class="clear"></div>
                               </div>
                          </div>
		                 <div class="login-line">
		                       <label class="label-no" for="login-user">用户名</label>
		                       <div class="element pos_rel">
		                             <input type="text" class="login-text login-icon-user" name="manageUser" id="manageUser" placeholder="请输入管理员账号" autocomplete="off" maxlength="50"  style="padding-left:0px;width:219px;" />
		                             <div class="clear"></div>
		                       </div>
		                  </div>
		                  <div class="login-line">
		                       <label class="label-no" for="login-password">操作员</label>
		                       <div class="element pos_rel">
		                             <select class="select" id="operator" onkeydown="if(9==event.keyCode) document.getElementById('_ocx_password').focus();">
		                                <option>选择操作员</option>
		                             </select>
		                             <div class="clear"></div>
		                       </div>
		                  </div>
		                  <!--<div class="login-line">
		                       <label class="label-no" for="login-password">密码</label>
		                       <div class="element pos_rel">
		                       		#parse("main/ocx/password_login_per.vm")
		                       </div>
						  </div>-->
		                  <input type="hidden" id="captcha_value" name="captcha_value" />
		                  <input type="hidden" id="operator_loginName" name="operator_loginName" />
		                  <div class="login-line">
		                       <label class="label-no" for="login-password">校验码</label>
		                       <div class="element pos_rel">
		                             <input type="text" class="login-text" name="login_captcha" id="login_captcha" placeholder="校验码" style="padding-left:0px;width:98px;" autocomplete="off" />
		                             <span class="index_yzm marl10">
		                             <img id="randImage" src="#springUrl('/pvc.htm')" style="cursor: pointer;" width="102" height="34" onclick="reloadcode();" /></span>
		                             <div class="clear"></div>
		                       </div>
		                  </div>
		                  <div class="login-line">
		                       <a class="qianbao-main" title="登录" id="user_login_submit" href="javascript:void(0)" onclick="return userLoginSubmit();">登&nbsp;&nbsp;&nbsp;&nbsp;录</a>
		                  </div>

							   
		      		</from>
              </div>
         </div>
    </div>     
    

<script type="text/javascript">
	$(window).load(function(){							 
            $.cookie('kjt_ent_user_name',null,{path: '/enterpriseWallet',domain: '${WEB_RESOURCE.staticAddressDomain}'});
     });

	function reloadcode() {
	   	$("#randImage").attr("src","#springUrl('/pvc.htm')?id="+Math.random());
	}
	
	$("#login_captcha").blur(function(){
		$("#captcha_value").val($("#login_captcha").val());
	});
	
	$("#manageUser").blur(function(){
       	var manageUser = $.trim($("#manageUser").val());  
       	var regPattern_email = /^(\w)+(\.\w+)*@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,4}$/;
		if(!regPattern_email.test(manageUser)) {
        	$("#login_error_msg").html('登录用户名不正确!');
        	$("#login_error_msg_parent").show();
        	reloadcode();
        	$("#user_login_submit").attr("disabled", "disabled");
			return false;
		}
		if ("" != manageUser) {
			// 查询操作员
			jQuery.ajax({
				url:"#springUrl('/login/query.htm')",
				type:'post',
				dataType:'json',
				data:$("#loginForm").serialize(),
				success:function(data, textStatus, jqXHR){
					if(data.success) {
				       	var tbody = "";
						jQuery.each(data.data.operators,function(n,value) {
							if (value.loginName.toUpperCase() == manageUser.toUpperCase()) {
								tbody += "<option value='"+value.loginName+"' data-for='"+value.operatorId+"' >Admin</option>";
							} else {
				             	tbody += "<option value='"+value.loginName+"' data-for='"+value.operatorId+"'>" +value.loginName+"</option>";
				            }  
			            });  
					    $("#operator").html(tbody);  
					    $("#user_login_submit").removeAttr("disabled");
	                } else {
	                	$("#user_login_submit").attr("disabled", "disabled");
	                	$("#login_error_msg").html(data.message);
	                	$("#login_error_msg_parent").show();
	                	reloadcode();
					}
				},
				error:function(XMLHttpRequest, textStatus, errorThrown){
					return false;
				}
			});
		}
	});
	
	
	//表单提交
	function userLoginSubmit() {
		/** if(pgeditor.pwdLength()==0){
	    	$("#login_error_msg").html('登录密码不能为空');
	    	$("#login_error_msg_parent").show();
	       	$("#_ocx_password").focus();
	       	reloadcode();
	       	return false;
	     }
	  
	   if(pgeditor.pwdValid()==1){
	   		$("#login_error_msg").html('登录密码不符合要求');
	    	$("#login_error_msg_parent").show();
	       	$("#_ocx_password").focus();
	       	reloadcode();
	       	return false;
	     }  
		 jQuery.ajax({
              url: "#springUrl('/ocx/generateRandomKey.htm')",
              type: "POST",
           	  async: false,
              success: function(result){
                  pgeditor.pwdSetSk(result);
              }
         });  
		 
	     var PwdResult=pgeditor.pwdResult();
	    $("#password").val(PwdResult);//获得密码密文,赋值给表单  */
	    
	    var manageUser = $.trim($("#manageUser").val());
	    
	    if(""==manageUser) {
	    	$("#login_error_msg").html('登录用户名不能为空!');
        	$("#login_error_msg_parent").show();
			return false;
	    }
	    
	    var regPattern_email = /^(\w)+(\.\w+)*@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,4}$/;
		var regPattern_mobile = /^[1]([3][0-9]{1}|([4][7]{1})|([5][0-3|5-9]{1})|([8][0-9]{1}))[0-9]{8}$/;
		if(!regPattern_email.test(manageUser) && !regPattern_mobile.test(manageUser)) {
        	$("#login_error_msg").html('登录用户名不正确!');
        	$("#login_error_msg_parent").show();
			return false;
		}
		
		var operator = $("#operator  option:selected").val();
		$("#operator_loginName").val(operator);
		
		var operator_type_value= $("#operator  option:selected").attr('data-for');
		$("#operatorId").val(operator_type_value);
		
		var login_captcha = $("#login_captcha").val();
		if ("" == login_captcha) {
        	$("#login_error_msg").html('验证码不能为空!');
        	$("#login_error_msg_parent").show();
			return false;
		}
		
		var captcha_value = $("#captcha_value").val();
		if(captcha_value!=login_captcha) {
			$("#login_error_msg").html('验证码填写错误!');
        	$("#login_error_msg_parent").show();
        	return false;
		}
		
	    jQuery.ajax({
			url:"#springUrl('/login/main.htm')",
			type:'post',
			dataType:'json',
			data:$("#loginForm").serialize(),
			success:function(data, textStatus, jqXHR){
				if(data.success) {
					window.location.href = data.redirect;
                } else {
                	$("#login_error_msg").html(data.message);
                	$("#login_error_msg_parent").show();
                	reloadcode();
				}
			},
			error:function(XMLHttpRequest, textStatus, errorThrown){
				return false;
			}
		});
	};
</script>